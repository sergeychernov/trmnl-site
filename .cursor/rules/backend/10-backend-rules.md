## Правила Cursor — backend/server

### Область
- API-роуты Next.js в `app/api/<segment>/route.ts`.
- Серверные компоненты и обработчики выполняются на сервере; не использовать браузерные API.

### Обработчики API
- Экспортируй методы: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`, `OPTIONS`.
- Ответы — через `NextResponse.json(data, { status })`.
- Ошибки: структура `{ error: string, details?: unknown }` + корректный HTTP-статус.
- Валидация входа: схему держать рядом (zod/valibot), валидировать до основной логики.
- Логирование: кратко и информативно; не логируй персональные данные и секреты.

### Конфигурация и перформанс
- Уважай `next.config.ts`: настроены `rewrites` для путей без хвостового слэша.
- Кэширование: явно указывай заголовки для идемпотентных GET, иначе по умолчанию no-store.
- Таймауты и отмена: поддерживай `AbortSignal` из `Request` при внешних запросах.

### Секреты и переменные окружения
- Читай из `process.env.*`. Не хардкоди значения.
- Клиентские значения — только с префиксом `NEXT_PUBLIC_` (но в backend обычно не нужно).

### Типы и структура
- Явные типы входа/выхода обработчиков. Не использовать `any`.
- Вспомогательные функции — чистые, с понятными сигнатурами и узкой областью ответственности.

### Тестирование и отладка
- Для сложной логики выноси функции в модули и покрывай юнит-тестами (инфраструктуру договариваем отдельно).


